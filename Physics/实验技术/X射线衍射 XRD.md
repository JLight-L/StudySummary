# 原理
通过光射入物质进行散射来得到物质的结构信息
1. 光会被原子位点散射，以弹性散射（Rayleigh散射）为主
2. 根据散射光叠加得到的衍射图案（衍射峰的位置）可以得到物质内部的原子位点分布
3. 衍射峰与晶体结构的关系：
    - 衍射峰对应的光满足 $\vec{k'}-\vec{k}=\vec{G_{hkl}}$ ，可以根据出入光的波长和夹角得到某个倒格矢的长度（即使周期性不是满足得很好，也可以根据倒格矢长度来推出实际的三维结构）
        - 布拉格方程 (Bragg's Law)：$nλ = 2d_{hkl}\sinθ$，其中 $n$ 是衍射级数（通常取1），$λ$是X射线波长，$d_{hkl}$是晶面间距（hkl为晶面指数），$θ$是布拉格角（入射/出射光与晶面的夹角）
    - 衍射峰强度 $I(G)=S(G)^{2}$ ，结构因子 $S(G)=\int_{\text{unit cell}}dxe^{ iG\cdot x }V(x)$ ，其中 $V(x)$ 为 $x$ 处的总势场；可以根据衍射峰的强度反推出晶胞内的原子位点信息
        - 根据 $V(x)=\sum_{\text{atom in unit cell}}V_{j}(x-x_{j})$ ，可以把结构因子按原子贡献进行拆解： $S=\sum_{j}f_{j}e^{ iG\cdot x_{j} },f_{j}=\int_{\text{unit cell}} dx V_{j}(x)e^{ iG\cdot x }$ ，$V_{j}$ 为元胞中第 $j$ 个原子的势场
        - 通过洛伦兹-偏振因子（LP）校正衍射几何导致的强度随角度变化
4. 衍射峰宽度来源：主要和晶粒（具有一个统一周期性结构的区域）大小有关，晶粒越小峰越宽（因为边界相距太近，周期性满足的不够好）
    1. 晶粒尺寸（Crystallite Size）：根据Scherrer公式，$τ = Kλ / (β \cosθ)$，其中 $τ$ 是晶粒在(hkl)法线方向的平均尺寸，$K$ 是形状因子（~0.9），$β$ 是衍射峰的积分宽度（需扣除仪器宽化效应）。晶粒越小，峰越宽。 #？？？ 去名词化
    2. 微观应变（Microstrain）：晶格内的非均匀应变也会导致峰宽化，其效应与 $\tanθ$ 有关。
    3. 仪器本身：X射线源非绝对平行、有发散度等也会导致一定的峰宽化。
# 控制元件
- **X射线光源**：通常为X射线管（产生连续谱和特征谱，如Cu靶Kα线）或同步辐射光源（高强度、高准直、波长可调）。
- **单色器/单色化技术**：用于从X射线光源中筛选出单一波长（如Cu Kα₁），常用石墨单色器或基于多层膜镜的Kβ滤波器。
- **测角仪 (Goniometer)**：核心部件，精确控制样品和探测器的角度关系。常用布拉格-布伦塔诺 (Bragg-Brentano) 几何，保证入射角与出射角始终相等（即ω-2θ联动，样品台转θ，探测器转2θ）。
- **样品台**：用于放置和固定样品，可具有多轴旋转、平移、加热、冷却等功能。
- **X射线探测器**：记录衍射X光子的强度和位置，如点探测器、一维位敏探测器、二维面探测器等。
- **索拉光阑 (Soller Slits)**：由一系列平行金属薄片组成，用于限制射线在轴向的发散度，提高角分辨率。
# 工作流程：准备、输入与输出
- 校准：角度校准：
    - 仪器零点校准：使用标准样品（如Si粉NIST SRM 640c）修正2θ系统误差（±0.01°）。
    - 样品位移修正：块体样品表面偏离测角仪中心时，引入Δ2θ=-2s cosθ/R（s为位移量，R为测角仪半径）。
- 输入：样品制备
    - 粉末样品：需研磨至合适粒度（通常<10μm），并压制成平整、无择优取向的片状。择优取向会导致衍射强度与标准卡片严重偏离。
    - 块体样品：表面需平整光滑。
    - 薄膜样品：通常无需特殊制备，但需注意基底信号干扰。
- 输出：衍射图谱，通常是衍射强度-出入射角度关系
    1. 从衍射峰位置可以得到所有测得的倒格矢长度（或晶面间距，一一对应），进行晶格结构的分析（不同种类晶格有不同种类的倒格矢长度分布）
    2. 根据衍射峰的强度反推晶胞中原子的位置
    3. 需要对不同的散射角度进行散射强度的修正
        - 为了从实测强度 $I_{obs}$ 得到能用于结构计算的结构因子模方 $|S|^2$，需要进行一系列物理因子校正：$|S_{hkl}|^2 \propto I_{obs} / (LPA T)$
            - **L - 洛伦兹因子 (Lorentz Factor)**：与衍射几何相关，校正不同衍射角下衍射机会的差异。
            - **P - 偏振因子 (Polarization Factor)**：校正X射线被样品偏振后散射效率的降低。
            - **A - 吸收因子 (Absorption Factor)**：校正样品对X射线的吸收。对于平板样品，它与θ角有关。对于圆柱状样品，吸收与θ无关。
            - **T - 温度因子 (Temperature Factor/Debye-Waller Factor)**：校正原子热振动对散射强度的衰减。
# 工作方式
1. **粉末衍射（Pole Figure/Texture Analysis）**：
    - **控制元件行为**：样品台旋转（通常以θ-2θ或θ-θ模式扫描），X射线发射器和探测器同步移动，保持入射角与反射角相等（布拉格-布伦塔诺几何）。测角仪精确控制角度步长（如0.01°/步）和扫描速度（如1°/min）。
    - **输入**：粉末样品（颗粒尺寸<10μm，压制成平整片），需避免择优取向（如通过背压法制样）。
    - **输出**：衍射强度-2θ图谱，用于物相鉴定（比对PDF卡片）和晶格参数精修（如Rietveld法）。

2. **单晶衍射（Single-Crystal XRD）**：
    - **控制元件行为**：样品台多轴旋转（如κ-几何或四圆测角仪），探测器固定或二维扫描（如CCD区域探测器）。需调节晶体取向使多个倒格矢满足衍射条件（通过旋转矩阵控制）。
    - **输入**：单晶样品（尺寸0.1-0.5mm，需低温冷冻（如100K）减少热振动噪声）。
    - **输出**：三维倒易空间衍射点强度，用于解析原子坐标（直接法或帕特森法）和精修热振动参数（B因子）。

3. **薄膜衍射（Grazing Incidence XRD, GIXRD）**：
    - **控制元件行为**：固定极小入射角（如0.5-2°），探测器单独扫描（2θ-ω解耦），避免基底信号干扰。样品台可倾斜（ψ扫描）分析应力。
    - **输入**：薄膜样品（厚度<1μm，需抛光基底如单晶硅），入射角低于临界角（全反射条件）。
    - **输出**：薄膜的掠入射衍射图谱，用于测定外延关系（如立方膜在六方基底上的取向）和残余应力（通过晶面间距偏移Δd/d计算）。

4. **原位变温/变环境XRD**：
    - **控制元件行为**：样品台集成加热炉（RT-1600°C）或低温腔（4K-300K），通入反应气体（如H₂/Ar混合气）。测角仪需动态补偿热膨胀导致的样品位移。
    - **输入**：块体或粉末样品（需密封在毛细管中防止氧化），实时监测相变（如TiO₂从锐钛矿到金红石）。
    - **输出**：温度-衍射强度三维图谱，用于动力学分析（如Avrami方程拟合晶粒生长指数）。

